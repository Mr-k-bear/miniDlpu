# miniDlpu
## 全局错误代码的定义

为了方便前端处理错误信息，后端全部接口实行错误代码统一标识的原则。
后端返回给前端的数据格式如下。

<br>
<br>
<br>
成功的例子：

```
{
    "code": 1,
    "msg": "信息获取成功！！",
    "data": {
        "key1": "数据1",
        "key2": "数据2"
    }
}
```

失败的例子：

```
{
    "code": 501,
    "msg": "教务处崩溃啦！！",
    "data": []
}
```

参数解释：

* code：错误代码，各各代码含义看下面解释，觉得不爽可以自己修改这个wiki。
* msg：前端展示给用户的信息，如果没啥好展示的话，就传空字符串。
* data：返回给前端的数据

### **从服务器上的数据返回格式规范**

从服务器上统一返回标准格式框架
点击这里下载 ----> [MiniDLPUMessage.php](http://ccpe.top/wen/jwc/MiniDLPUMessage.php.txt)
具体使用方法写在源码的注释里，先凑活着看吧，之后会陆续完善文档。

#### **错误代码的定义**

###### 0：未知错误

1：成功
2：数据缺失或非法

```
201：空数据包
202：数据包缺失部分键值
203：数据包部分键值为非法数据
204：请求头数据不完整
205：请求头部分键值为非法数据
```

###### 3：签名错误

```
301：签名不完整
302：签名无法通过完整性检验
303：签名不正确
304：主服务器签名错误
305：附加签名错误
```

###### 4：代理错误

```
401：从服务器崩溃
402：从服务器响应超时
403：从服务器已经ban掉了
404：找不到从服务器
```

###### 5：教务处错误

```
501：教务处崩溃
502：教务处响应超时
503：找不到教务处
```

###### 6：业务逻辑错误

```
601：密码错误
602：JSSession失效
603：查不到数据
```

###### 7：开发过程中你可以随意的补充或修改（改动时记得修改这个wiki）

## 从服务器所有爬虫API接受数据规范

主服务器发给从服务器的数据包格式如下：

```
a=0f8g9u49878d8f&b=09s7dfuhoi8ydsf9&i=11.25.214.23&d={"data":"value","data2":"value"}
```

参数解释：

* a：前端生成的签名，用于验证数据是否是前端发出的
* b：主服务器生成的签名，用于验证数据是否是主服务器发出的
* i：前端发送数据时使用的IP
* d：JSON格式的数据，主要用于业务逻辑（可以加密处理）

## 主服务器调试接口 && debug小工具

为了方便调试，主服务器在开发阶段开放了一个特殊的接口，用来实时了解主服务上发生了什么。
该接口使用 webSocket 作为通信，像这样：

```
ws://ccpe.top:8888
```

#### **怎么连接调试接口，接受调试信息呢？**

很简单，只需要一句话，在浏览器任意页面控制台运行下面这句话就可以了

```
new WebSocket("ws://ccpe.top:8888").onmessage = (evt) => console.log(evt.data);
```

运行之后，你就能在控制看到主服务器上实时的调试信息了。

#### **关于跨域问题？**

不用担心，主服务器在开发过程中已经使用了跨域请求头，所以你可以在浏览器任何页面使用这个调试工具！
